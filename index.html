<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>de-ve-de</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
   <div id="welcome"> 
    <h1>The De-Ve-De MovieBase</h1>
    <h4>We keep track on your movies!</h4>
    <img id="logo" src="IMG/Group 6.svg" alt="">
    </div>

    <div id="enterDetails">
       
        <h2>Add your movies</h2>
        <h4>Title</h4>
        <input id="enterTitle" type="text">

        <h4>Genre</h4>
        <input id="enterGenre" type="text">

        <h4>Release Date</h4>
        <input id="enterReleaseDate" type="number">

        <h4>Watched</h4>
        <input id="enterWatched" type="checkbox"><br><br>

        <button id="insert">ADD</button>
        <button id="update">UPDATE</button>
        <button id="remove">DELETE</button>
        <!-- <button id="watched">WATCHED</button> -->

    </div>

    <div id="findDetails">
        <h1>Search by Title</h1> 
        <h4>Title</h4>
        <input id="findTitle" type="text"> <br><br>
        <button id="find">SEARCH</button>
        <h3 id="findGenre" type="text"></h3>
        <h3 id="findReleaseDate" type="number"></h3>
        <h3 id="findWatched" type="checkbox"></h3>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyD3PWNl_b_hUGYUl3oEjQXqSqNoUErKphc",
          authDomain: "de-ve-de-63d1b.firebaseapp.com",
          databaseURL: "https://de-ve-de-63d1b-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "de-ve-de-63d1b",
          storageBucket: "de-ve-de-63d1b.appspot.com",
          messagingSenderId: "553934058133",
          appId: "1:553934058133:web:4d4006d4f236e3b296219c"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import {getDatabase, set, get, update, remove, ref, child}
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"

        const db = getDatabase();

        let enterTitle = document.querySelector("#enterTitle");
        let enterGenre = document.querySelector("#enterGenre");
        let enterReleaseDate = document.querySelector("#enterReleaseDate");
        let enterWatched= document.querySelector("#enterWatched");
        let findTitle = document.querySelector("#findTitle");
        let findGenre = document.querySelector("#findGenre");
        let findReleaseDate = document.querySelector("#findReleaseDate");
        let findWatched = document.querySelector("#findWatched");   

        let insertButton = document.querySelector("#insert");
        let updateButton = document.querySelector("#update");
        let removeButton = document.querySelector("#remove");
        let watchedButton = document.querySelector("#watched");
        let findButton = document.querySelector("#find");
        
        function InsertData() {
            const movieRef = ref(db, "Movies/" + enterTitle.value);
            get(movieRef)
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        alert("A movie with the same title already exists!");
                    } else {
                        set(movieRef, {
                            Title: enterTitle.value,
                            Genre: enterGenre.value,
                            ReleaseDate: enterReleaseDate.value,
                            Watched: enterWatched.checked
                        })
                        .then(() => {
                            alert("Your movie was saved!");
                        })
                        .catch((error) => {
                            alert(error);
                        });
                    }
                })
                .catch((error) => {
                    alert(error);
                });
        }
        function FindData() {
            const dbref = ref(db);
            get(child(dbref, "Movies/" + findTitle.value))
            .then((snapshot)=>{
                if (snapshot.exists()) {
                    findGenre.innerHTML = "Genre: " + snapshot.val().Genre;
                    findReleaseDate.innerHTML = "ReleaseDate: " + snapshot.val().ReleaseDate;
                    findWatched.innerHTML = "Watched: " + (snapshot.val().Watched ? "Yes" : "No");
                } else {
                    alert("You don't have a movie with that name, yet!");
                }
            })
            .catch((error)=>{
                alert(error);
            });
        }
        function UpdateData() {
            update(ref(db, "Movies/" + enterTitle.value), {
                Genre: enterGenre.value,
                ReleaseDate: enterReleaseDate.value,
                Watched: enterWatched.checked
            })
            .then(()=>{
                alert("The movie was updated!");
            })
            .catch((error)=>{
                alert(error);
            });
            
        }
        function RemoveData() {
            remove(ref(db, "Movies/" + enterTitle.value))
            .then(()=>{
                alert("The movie was removed!");
            })
            .catch((error)=>{
                alert(error);
            })
        };

        insertButton.addEventListener('click', InsertData);
        updateButton.addEventListener('click', UpdateData);
        removeButton.addEventListener('click', RemoveData);
        findButton.addEventListener('click', FindData);

      </script>

</body>
</html>